#!/usr/bin/env bash

# Disabling the SC2034 warning from Shellcheck (SC2034: <Variable name> appears unused. Verify use (or export if used externally)), because of the huge number of global variables declared in the configuration files, but only used in the library files.
# shellcheck disable=SC2034

# This configuration file stores main module's initialization process related global variables.

# ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; #

######################################## DEFINING VARIABLES #######################################

#### DEFINING THE NEEDED RESOURCES

# Feel free to define any needed resources (functions, etc...) here.



# -----------------------------------------------

# /////////////////////////////////////////////////////////////////////////////////////////////// #

#### PROCESSING FILE SYSTEM'S INFORMATIONS

# Getting the filesystem's name with the "df" command, and parsing the output list according to the operating system's command version.
BU::IsOSHaiku && __BU_MAIN_FS_NAME="$(df "$0" | awk 'FNR == 4 {print $3}')";
BU::IsOSLinux && __BU_MAIN_FS_NAME="$(df -Th "$0" | awk 'FNR == 2 {print $2}')";

## EXT2 FILE SYSTEM'S INFORMATIONS
 
if [ "${__BU_MAIN_FS_NAME,,}" = 'apfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "This global variable stores the maximum length in bytes of a file name. This length is associated with the Apple's APFS file system" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## BTRFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'btrfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the Btrfs file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT2 FILE SYSTEM'S INFORMATIONS
 
elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext2' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the EXT2 file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT3 FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext3' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the EXT3 file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT4 FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext4' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the EXT4 file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## JFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'jfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the JFS file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## XFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'xfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the XFS file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## ZFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'zfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is associated with the ZFS file system' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

else
    BU::Main::Errors::HandleSmallErrors 'W' "Unsupported filesystem (found $(BU::DechoHighlight "$__BU_MAIN_FS_NAME"))\n\nGeneration of basic informations, but several functionalities of this framework may be prone to bugs" 'R';

    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        'This global variable stores the maximum length in bytes of a file name. This length is not associated with any file system, but rather according to general specification' \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";
fi
