#!/usr/bin/env bash

# Disabling the SC2034 warning from Shellcheck (SC2034: <Variable name> appears unused. Verify use (or export if used externally)), because of the huge number of global variables declared in the configuration files, but only used in the library files.
# shellcheck disable=SC2034

# This configuration file stores main module's initialization process related global variables.

# ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; #

######################################## DEFINING VARIABLES #######################################

#### DEFINING THE NEEDED RESOURCES

## FUNCTIONS

# Writing the command substitution text for the file systems description strings.
function BU::Main::ModConfig::Filesystem::PrintFSLengthDescription()
{
    printf "$__BU_MODULE_INIT_MSG__BU_MAIN_MODCONFIG__FILESYSTEM__MAX_LENGHT_STR_MSG" "$?";
}

# -----------------------------------------------

# /////////////////////////////////////////////////////////////////////////////////////////////// #

#### PROCESSING FILE SYSTEM'S INFORMATIONS

# Getting the file system's name with the "df" command, and parsing the output list according to the operating system's command version.
BU::IsOSHaiku && __BU_MAIN_FS_NAME="$(df "$0" | awk 'FNR == 4 {print $3}')";
BU::IsOSLinux && __BU_MAIN_FS_NAME="$(df -Th "$0" | awk 'FNR == 2 {print $2}')";

## EXT2 FILE SYSTEM'S INFORMATIONS
 
if [ "${__BU_MAIN_FS_NAME,,}" = 'apfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription "Apple's APFS")" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## BTRFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'btrfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'Btrfs')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT2 FILE SYSTEM'S INFORMATIONS
 
elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext2' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'EXT2')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT3 FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext3' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'EXT3')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## EXT4 FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'ext4' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'EXT4')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## JFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'jfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'JFS')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## XFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'xfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'XFS')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

## ZFS FILE SYSTEM'S INFORMATIONS

elif [ "${__BU_MAIN_FS_NAME,,}" = 'zfs' ]; then
    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$(BU::Main::ModConfig::Filesystem::PrintFSLengthDescription 'ZFS')" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";

# -----------------------------------------------

else
    # shellcheck disable=SC2059
    BU::Main::Errors::HandleSmallErrors 'W' "$(printf "$__BU_MODULE_INIT_MSG__BU_MAIN_MODCONFIG__FILESYSTEM__UNSUPPORTED_FILESYSTEM" "$(BU::DechoHighlight "$__BU_MAIN_FS_NAME")")" 'R';

    # File system max filename length.
    __BU_MAIN_FS_MAX_FILENAME_LENGTH='255';

    BU::ModuleInit::DisplayInitGlobalVarsInfos '__BU_MAIN_FS_MAX_FILENAME_LENGTH' "$__BU_MAIN_FS_MAX_FILENAME_LENGTH" 'Int' \
        "$__BU_MODULE_INIT_MSG__BU_MAIN_MODCONFIG__FILESYSTEM__SET_GENERAL_SPECIFICATION__FILENAME_LENGTH" \
        "$(basename "${BASH_SOURCE[0]}")" "${FUNCAME[0]}" "$(( LINENO-2 ))";
fi
