#!/usr/bin/env bash

# ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; #

#################################### DEFINING LIBRARY FUNCTIONS ###################################

#### READING KEYBOARD INPUTS

## GETTING ANSWERS FROM A QUESTION

# This function allows to test the cases where the user answers by "yes", "no" or something else than "yes" or "no".
# The two comas following directly the "$ans_yesno" between the braces mean that the answers are not case sensitive.

# Featured functions and files from the "functions" folder :
#   - EchoError         -> Echo.lib
#   - EchoNewstep       -> Echo.lib
#   - EchoSuccess       -> Echo.lib
#   - Newline           -> Echo.lib
function KbInputYesNo
{
    #***** Parameters *****
    local description=$1
    local ans_yes=$2
    local cmd_ans_yes=$3
    local ans_no=$4
    local cmd_ans_no=$5

    #***** Code *****
    EchoNewstep "$description"
    Newline
    
    read -rp "Enter your answer : " ans_yesno
    
    # If the "STAT_LOG_REDIRECT" status variable contains one of its redirection value ('log' or 'tee'), the answer is redirected to the log file with the date.
    if [ -n "$__STAT_LOG_REDIRECT" ]; then
        echo "[$__TIME_DATE] Answer : $(Decho "$ans_yesno")" >> "$__PROJECT_LOG_FILE_PATH"
    fi; Newline
    
    case ${ans_yesno,,} in
        "oui" | "yes")
            EchoMsg "$(tput setaf "$__COL_GREEN")$ans_yes$(tput sgr0)"
            Newline
            
            case "$cmd_ans_yes" in
                "return")
                    return
                    ;;
                "exit")
                    exit 1
                    ;;
                *)
                    # shellcheck disable=2034
                    __STAT_ERROR="fatal"
                    HandleErrors "1" "BAD $(DechoE "cmd_ans_yes") ARGUMENT VALUE" \
                        "The awaited values are $(DechoE "return") and $(DechoE "exit")" \
                        "$cmd_ans_yes" "$(basename "${BASH_SOURCE[0]}")" "${FUNCNAME[0]}" "$(( LINENO-11 ))"
                    ;;
            esac
            ;;
        "non" | "no")
            EchoError "$ans_no"
            Newline
            ;;
        *)
            EchoError "Please enter a valid answer"
            EchoError "The valid answers are $(tput setaf "$COL_CYAN")yes$(tput setaf "$COL_RED") and $(tput setaf "$COL_CYAN")no$(tput sgr0)"
            Newline
            
            KbInputYesNo "$description" "$ans_yes" "$cmd_ans_yes" "$ans_no" "$cmd_ans_no"
    esac
}
