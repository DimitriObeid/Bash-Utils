#!/usr/bin/env bash

## VARIABLE DECLARATION

# These status variables can be changed anywhere in the main script, except for the following variables :
#   - PROJECT_STATUS_DEBUG      -> This variable is used as (...).

# Project's debug variable --> This variable only accepts "true" or "false" as values.
# Default value : "false"
# shellcheck disable=SC2034
STAT_DEBUG="false"

# Project's error handling --> This variable accepts "fatal" or nothing as value.
# Default value : "" (no value)
# shellcheck disable=SC2034
STAT_ERROR=""

# Project's main log file informations --> This variable only accepts "true" or "false" as values.
# Default value : "true"
# shellcheck disable=SC2034
STAT_LOG="true"

# Project's main log file redirections status --> This variables accepts "log", "tee" or nothing as value.
# Default value : "" (no value)
# shellcheck disable=SC2034
STAT_LOG_REDIRECT=""

# Project's messages display time --> This variable accepts any integer of floating number.
# Default value : ".5"
# shellcheck disable=SC2034
STAT_TIME_TXT=".5"

# User's operating system (getting user's OS is important for OS-dependent processings, like package management)
# --> This variable will be completed with the "CheckSupportedOSType" function.
# Default value : "" (no value)
# shellcheck disable=SC2034
STAT_USER_OS=""


# -----------------------------------------------

## VARIABLES VALUES CHECKING

# Easy writing text function.
function ConfEcho
{
    #***** Parameters *****
    var=$1
    val=$2
    
    #***** Variables *****
    arr=("$@")

    #***** Code *****
    echo >&2; echo "$(tput setaf "$COL_RED")Error : the $(tput setaf "$COL_CYAN")$var$(tput setaf "$COL_RED") variable's value is incorrect$(tput sgr0)" >&2
    echo "$(tput setaf "$COL_RED")The awaited values are :$(tput sgr0)" >&2
    
    # Displaying the list of every allowed arguments.
    for i in "${val[@]}"; do
        # If an empty argument is allowed.
        if [ -z "$val" ]; then
            echo "$(tput setaf "$COL_RED")  --> $(tput setaf "$COL_ORANGE")An empty argument$(tput sgr0)" >&2
        else
            echo "$(tput setaf "$COL_RED")  --> $(tput setaf "$COL_CYAN")$val$(tput sgr0)" >&2
        fi
    done
    
    echo >&2; ExitError
}

# Checking the "$STAT_DEBUG" variable's value.
function CheckSTAT_DEBUG
{
    if [ "$STAT_DEBUG" != "true" ] && [ "$STAT_DEBUG" != "false" ]; then
        ConfEcho "STAT_DEBUG" "true" "false"
    fi
}

# Checking the "$STAT_ERROR" variable's value.
function CheckSTAT_ERROR
{
    if [ -n "$STAT_ERROR" ] && [ "$STAT_ERROR" != "fatal" ]; then
        ConfEcho "STAT_ERROR" "" "false"
    fi
}

# Checking the "$STAT_LOG" variable's value.
function CheckSTAT_LOG
{
    if [ "$STAT_LOG" != "true" ] && [ "$STAT_LOG" != "false" ]; then
        ConfEcho "STAT_LOG" "true" "false"
    fi
}

# Checking the "$STAT_LOG_REDIRECT" variable's value.
function CheckSTAT_LOG_REDIRECT
{
    if [ -n "$STAT_LOG_REDIRECT" ] && [ "$STAT_LOG_REDIRECT" != 'log' ] && [ "$STAT_LOG_REDIRECT" != 'tee' ]; then
        ConfEcho "STAT_LOG_REDIRECT" "" "true" "false"
    fi
}

# Checking the "$STAT_TIME_TXT" variable's value.
function CheckSTAT_TIME_TXT
{
    # If the status variable's value is not a float or an integer.
    if [[ ! "$STAT_TIME_TXT" =~ ^([0-9]+\.?|[0-9]*\.[0-9]+)$ ]]; then
        ConfEcho "STAT_TIME_TXT"
    fi
}

# Checking the "$STAT_USER_OS" variable's value.
# This function is empty now, as the OS handling is still in work.
function CheckSTAT_USER_OS
{
    return
}


# Checking all the project's status variables values if multiple values had been modified.
function CheckProjectStatusVars
{
    # Processing first the "STAT_LOG_REDIRECT" variable, to make sure the following error messages will be correctly displayed if another error happened.
    CheckSTAT_LOG_REDIRECT
    CheckSTAT_DEBUG
    CheckSTAT_ERROR
    CheckSTAT_LOG
    CheckSTAT_TIME_TXT
}

# Checking the project's status variables before switching back to the project's script.
# This function will be executed during the sourcing of this file in the initializer script.
# There's no need to call it in the forementionned script.
CheckProjectStatusVars
